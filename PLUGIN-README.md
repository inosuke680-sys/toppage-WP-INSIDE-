# WP Hero Image Manager

**バージョン:** 2.8.4
**作成者:** inosuke680-sys
**ライセンス:** GPL v2 or later

## 概要

WP Hero Image Manager は、WordPressの投稿にヒーロー画像を追加し、アイキャッチ画像との重複表示を防ぐプラグインです。

## 主な機能

### バージョン 2.8.4 の改善点

- **重複表示の完全防止**: 記事内でアイキャッチ画像とヒーロー画像が重複して表示される問題を解決
- **柔軟な表示制御**: カテゴリページやアーカイブページではアイキャッチ画像を正常に表示
- **シングルページでの最適化**: ヒーロー画像を使用する場合、アイキャッチ画像の自動非表示オプション
- **安定性の向上**: エラーハンドリングとセキュリティの強化
- **上位互換性**: 以前のバージョンからのスムーズな移行をサポート

### 機能一覧

1. **ヒーロー画像の管理**
   - 投稿ごとにヒーロー画像を設定可能
   - WordPressメディアライブラリとの完全統合
   - 直感的なメタボックスインターフェース

2. **重複防止機能**
   - シングルページでのアイキャッチ画像自動非表示オプション
   - カテゴリ・アーカイブページでは正常にアイキャッチを表示
   - テーマとの高い互換性

3. **レスポンシブデザイン**
   - モバイル、タブレット、デスクトップに最適化
   - 画像の自動リサイズとレイアウト調整
   - プリント時の最適化

4. **開発者フレンドリー**
   - テンプレート用ヘルパー関数
   - フィルターフック
   - カスタマイズ可能なCSS

## インストール方法

### 標準的なインストール

1. このプラグインファイルをWordPressの `wp-content/plugins/` ディレクトリにアップロード
2. WordPress管理画面の「プラグイン」メニューからプラグインを有効化
3. 投稿編集画面のサイドバーに「ヒーロー画像設定」メタボックスが表示されます

### ディレクトリ構造

```
wp-hero-image-manager/
├── wp-hero-image-manager.php    # メインプラグインファイル
├── assets/
│   ├── css/
│   │   ├── admin.css            # 管理画面用スタイル
│   │   └── frontend.css         # フロントエンド用スタイル
│   └── js/
│       └── admin.js             # 管理画面用JavaScript
├── PLUGIN-README.md             # このファイル
└── README.md                    # プロジェクト全体のREADME
```

## 使用方法

### 基本的な使い方

1. **投稿編集画面で設定**
   - 投稿の編集画面を開く
   - サイドバーの「ヒーロー画像設定」メタボックスを探す
   - 「ヒーロー画像を使用する」にチェック
   - 「ヒーロー画像を選択」ボタンをクリック
   - メディアライブラリから画像を選択

2. **重複防止の設定**
   - ヒーロー画像を設定後、「記事内でアイキャッチ画像を非表示にする（重複防止）」にチェック
   - これにより、シングルページではヒーロー画像のみが表示されます
   - カテゴリページやアーカイブページでは引き続きアイキャッチ画像が表示されます

3. **投稿を保存・公開**
   - 設定を保存すると、フロントエンドに反映されます

### テンプレートでの使用

プラグインは以下のヘルパー関数を提供します:

```php
<?php
// ヒーロー画像が存在するかチェック
if ( has_hero_image() ) {
    // ヒーロー画像を表示
    the_hero_image();
}

// ヒーロー画像IDを取得
$hero_image_id = get_hero_image_id();

// カスタムサイズで表示
if ( $hero_image_id ) {
    echo wp_get_attachment_image( $hero_image_id, 'large' );
}
?>
```

### カスタマイズ

#### CSSのカスタマイズ

テーマの `style.css` または `functions.php` でスタイルを上書きできます:

```css
/* ヒーロー画像のカスタムスタイル */
.wp-hero-image-container {
    margin-bottom: 3em;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.wp-hero-image {
    border-radius: 8px;
}
```

#### フィルターフック

```php
// ヒーロー画像のHTMLをカスタマイズ
add_filter( 'the_content', function( $content ) {
    // カスタムロジック
    return $content;
}, 4 ); // プラグインのフィルター（優先度5）より前に実行
```

## よくある質問

### Q: アイキャッチ画像が重複して表示されます

A: 「記事内でアイキャッチ画像を非表示にする（重複防止）」のチェックボックスを有効にしてください。これにより、シングルページではヒーロー画像のみが表示され、アーカイブページではアイキャッチ画像が正常に表示されます。

### Q: カテゴリページでアイキャッチ画像が表示されません

A: このプラグインはシングルページでのみアイキャッチ画像を非表示にします。カテゴリページやアーカイブページでは正常に表示されるはずです。テーマの設定を確認してください。

### Q: ヒーロー画像のサイズを変更したい

A: `assets/css/frontend.css` を編集するか、テーマのCSSで `.wp-hero-image` クラスをカスタマイズしてください。

### Q: 既存のアイキャッチ画像をヒーロー画像として使用できますか？

A: はい。メディアライブラリから同じ画像を選択できます。ただし、重複を防ぐため「記事内でアイキャッチ画像を非表示にする」を有効にすることをお勧めします。

### Q: プラグインを無効化するとヒーロー画像はどうなりますか？

A: プラグインを無効化すると、ヒーロー画像は表示されなくなりますが、メタデータはデータベースに保持されます。再度有効化すれば、設定は復元されます。

## トラブルシューティング

### 画像が表示されない

1. ファイルパーミッションを確認
2. ブラウザのキャッシュをクリア
3. WordPressのキャッシュプラグインを無効化して確認
4. テーマとの競合を確認

### 管理画面で画像選択ボタンが動作しない

1. JavaScriptエラーがないかブラウザのコンソールを確認
2. 他のプラグインとの競合を確認
3. WordPressとテーマを最新版に更新

## 技術仕様

### 要件

- **WordPress**: 5.0 以上
- **PHP**: 7.2 以上
- **MySQL**: 5.6 以上

### 使用技術

- WordPress Plugin API
- WordPress Media Library API
- jQuery
- CSS3
- HTML5

### セキュリティ

- Nonce検証によるCSRF保護
- データサニタイゼーション
- エスケープ処理
- 権限チェック

## 変更履歴

### バージョン 2.8.4 (2025-11-15)

- **修正**: 記事内でアイキャッチ画像とヒーロー画像が重複する問題を解決
- **改善**: シングルページとアーカイブページでの表示制御を最適化
- **追加**: 「記事内でアイキャッチ画像を非表示にする」オプション
- **強化**: セキュリティとエラーハンドリングの改善
- **最適化**: フロントエンドCSSの改良
- **互換性**: WordPress 6.x との完全互換性確認

### バージョン 2.8.3 以前

- 基本的なヒーロー画像機能
- メディアライブラリ統合

## サポート

問題が発生した場合は、以下のリンクから報告してください:

**GitHub Issues**: https://github.com/inosuke680-sys/toppage-WP-INSIDE-/issues

## ライセンス

このプラグインはGPL v2またはそれ以降のライセンスの下で配布されています。

## クレジット

**開発者**: inosuke680-sys
**プロジェクトURL**: https://github.com/inosuke680-sys/toppage-WP-INSIDE-

---

**注意**: このプラグインは継続的に改善されています。フィードバックや提案があれば、GitHubでお知らせください。
