# 変更履歴 (Changelog)

このファイルには、WP Hero Image Manager の全バージョンの変更内容を記録しています。

## [2.8.4] - 2025-11-15

### 🐛 修正 (Fixed)
- **重複表示の問題を解決**: 記事内でアイキャッチ画像とヒーロー画像が重複して表示される問題を完全に修正
- **表示制御の最適化**: `filter_featured_image()` メソッドでシングルページのみアイキャッチを非表示にするよう改善
- **セキュリティ強化**: Nonce検証、権限チェック、データサニタイゼーションを徹底

### ✨ 追加 (Added)
- **新しいオプション**: 「記事内でアイキャッチ画像を非表示にする（重複防止）」チェックボックスを追加
- **メタキーの追加**: `_hide_featured_image` メタキーでアイキャッチ非表示を制御
- **ヘルパー関数**: テンプレート用の `get_hero_image_id()`, `has_hero_image()`, `the_hero_image()` 関数を追加
- **管理画面UI改善**: より直感的なメタボックスインターフェース
- **詳細な説明文**: 各オプションの使い方を明確に説明

### 🚀 改善 (Improved)
- **表示ロジックの最適化**:
  - カテゴリページ: アイキャッチ画像を正常に表示
  - アーカイブページ: アイキャッチ画像を正常に表示
  - シングルページ（ヒーロー有効）: ヒーロー画像のみ表示、アイキャッチは非表示
  - シングルページ（ヒーロー無効）: 通常通りアイキャッチを表示
- **コードの安定性**: エラーハンドリングの改善
- **パフォーマンス**: 不要な処理を削減し、効率化
- **CSS**: レスポンシブデザインの強化とアニメーション追加
- **JavaScript**: メディアアップローダーの動作を最適化

### 🎨 スタイリング (Styling)
- **フロントエンドCSS**:
  - ヒーロー画像のフェードインアニメーション
  - レスポンシブ対応の改善
  - プリント時の最適化
  - 全幅レイアウト（alignwide, alignfull）のサポート
- **管理画面CSS**:
  - より洗練されたメタボックスデザイン
  - モバイル対応の改善
  - 視認性の向上

### 📚 ドキュメント (Documentation)
- **README.md**: 包括的なプロジェクト説明を追加
- **PLUGIN-README.md**: 詳細な使用方法とトラブルシューティングガイド
- **CHANGELOG.md**: このファイル
- **INSTALL.md**: インストールガイドを追加
- **コード内コメント**: PHPDocスタイルのドキュメンテーション

### 🔒 セキュリティ (Security)
- **CSRF保護**: Nonce検証の実装
- **XSS対策**: すべての出力でエスケープ処理
- **権限チェック**: `current_user_can()` による権限確認
- **データバリデーション**: 入力値の厳格な検証
- **直接アクセス防止**: `ABSPATH` チェックの実装

### ⚡ パフォーマンス (Performance)
- **最適化されたクエリ**: メタデータの効率的な取得
- **キャッシュフレンドリー**: WordPressオブジェクトキャッシュと互換性
- **遅延読み込み**: 必要な時のみアセットを読み込み
- **画像最適化**: loading="eager" 属性でヒーロー画像を優先読み込み

### 🧪 互換性 (Compatibility)
- **WordPress 6.x**: 最新版との完全互換性確認
- **WordPress 5.0+**: 下位互換性を維持
- **PHP 7.2+**: 最新のPHPバージョンに対応
- **主要テーマ**: Twenty Twenty-One, Twenty Twenty-Two などで動作確認
- **ブロックエディタ**: Gutenberg との完全互換性

### 🛠️ 技術的な変更 (Technical Changes)
- **シングルトンパターン**: クラスインスタンスの適切な管理
- **フック体系**: WordPressのベストプラクティスに準拠
- **名前空間**: グローバル空間の汚染を防止
- **コーディング規約**: WordPress Coding Standardsに準拠

---

## [2.8.3] - 以前のバージョン

### 機能
- 基本的なヒーロー画像機能
- メディアライブラリ統合
- メタボックスUI

### 既知の問題
- アイキャッチ画像とヒーロー画像の重複表示 → **v2.8.4で修正**

---

## アップグレード方法

### 2.8.3 から 2.8.4 へ

1. **バックアップ**:
   ```bash
   # データベースとファイルをバックアップ
   ```

2. **プラグインの更新**:
   ```bash
   cd wp-content/plugins/wp-hero-image-manager
   git pull origin main
   ```

3. **設定の確認**:
   - 既存の投稿でヒーロー画像を使用している場合
   - 「記事内でアイキャッチ画像を非表示にする」オプションを有効化することを推奨

4. **動作確認**:
   - フロントエンドで記事ページを確認
   - カテゴリページでアイキャッチが表示されることを確認
   - 管理画面でメタボックスが正常に動作することを確認

### データの互換性

- **メタデータ**: すべてのメタデータは後方互換性があります
- **設定**: 既存の設定は自動的に移行されます
- **画像**: すべての画像は引き続き正常に機能します

---

## サポート対象バージョン

| バージョン | サポート状況 | セキュリティ更新 |
|----------|------------|----------------|
| 2.8.4    | ✅ 完全サポート | ✅ 提供中 |
| 2.8.3    | ⚠️ 非推奨 | ❌ 終了 |
| それ以前 | ❌ サポート終了 | ❌ 終了 |

---

## フィードバック

バグ報告や機能リクエストは、GitHubのIssuesページまでお願いします:
https://github.com/inosuke680-sys/toppage-WP-INSIDE-/issues

---

**凡例**:
- 🐛 バグ修正
- ✨ 新機能
- 🚀 改善
- 🎨 スタイリング
- 📚 ドキュメント
- 🔒 セキュリティ
- ⚡ パフォーマンス
- 🧪 互換性
- 🛠️ 技術的な変更
