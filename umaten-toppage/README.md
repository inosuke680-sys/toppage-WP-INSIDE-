# Umaten トップページプラグイン

WordPressのトップページ用プラグインです。動的なカテゴリ・タグ表示機能を備え、北海道ナビゲーションの内部リンク最適化に対応しています。

## 主な機能

### 1. 動的エリア管理
- 8つの主要地域（北海道、東北、関東、中部、関西、中国、四国、九州・沖縄）
- 各エリアごとに「公開中」「準備中」「非表示」の設定が可能
- 管理画面から簡単に切り替え可能

### 2. 3段階ナビゲーション（北海道最適化）
北海道をクリックすると以下の流れでナビゲーションが進みます：
1. **親カテゴリ選択**（北海道）
2. **子カテゴリ選択**（札幌市、函館市など）- 画像なしのシンプル表示
3. **ジャンル選択**（ラーメン、寿司など）+ **「すべてのジャンル」ボタン**

最終的に以下のURL形式で遷移します：
```
https://umaten.jp/hokkaido/子カテゴリ/ジャンル/
https://umaten.jp/hokkaido/子カテゴリ/（すべてのジャンル）
```

### 3. レスポンシブデザイン
- デスクトップ、タブレット、スマートフォンに完全対応
- モダンなUI/UXデザイン
- タッチ操作に最適化

### 4. 動的コンテンツ
- カテゴリとタグはWordPressから動的に取得
- 統計情報を自動表示：
  - **掲載店舗**: 公開済み投稿数
  - **口コミ**: 投稿数 × 3（概算）
  - **月間アクセス**: アクセスログプラグイン連携または概算値
- AJAXによる高速なコンテンツ読み込み

## インストール方法

### 1. プラグインのアップロード
1. `umaten-toppage` フォルダをWordPressの `wp-content/plugins/` ディレクトリにアップロード
2. WordPressの管理画面にログイン
3. 「プラグイン」メニューから「Umaten トップページ」を有効化

### 2. 初期設定
プラグインを有効化すると、デフォルトで以下の設定が自動的に適用されます：
- 北海道：公開中
- その他のエリア：準備中

### 3. ショートコードの配置
トップページとして表示したい固定ページに以下のショートコードを挿入：

```
[umaten_toppage]
```

## 管理画面の使い方

### エリア設定画面へのアクセス
1. WordPressの管理画面にログイン
2. 左メニューの「トップページ設定」をクリック

### エリアの公開状態を変更
各エリアごとに以下の3つの状態から選択できます：

#### ✓ 公開中
- エリアが通常表示されます
- ユーザーがクリック可能です
- 子カテゴリとジャンル選択に進めます

#### ⏳ 準備中
- エリアは表示されますが「準備中」マークが付きます
- クリックできません
- 「現在準備中です」のメッセージが表示されます

#### ✕ 非表示
- エリアが完全に非表示になります
- タブボタン自体が表示されません

### 表示ラベルのカスタマイズ
各エリアの表示ラベルを変更できます（例：「北海道エリア」など）

## ショートコードのオプション

基本的な使い方：
```
[umaten_toppage]
```

セクションの表示/非表示を制御：
```
[umaten_toppage show_hero="yes" show_stats="yes" show_genres="yes" show_areas="yes"]
```

### パラメータ

| パラメータ | デフォルト | 説明 |
|-----------|----------|------|
| `show_hero` | `yes` | ヒーローセクション（メインビジュアル）の表示 |
| `show_stats` | `yes` | 統計情報バーの表示 |
| `show_genres` | `yes` | 人気ジャンルセクションの表示 |
| `show_areas` | `yes` | エリア選択セクションの表示 |

## カテゴリとタグの設定

### 親カテゴリの作成
北海道などの親カテゴリを作成する際は、スラッグを以下のように設定してください：

- 北海道: `hokkaido`
- 東北: `tohoku`
- 関東: `kanto`
- 中部: `chubu`
- 関西: `kansai`
- 中国: `chugoku`
- 四国: `shikoku`
- 九州・沖縄: `kyushu-okinawa`

### 子カテゴリの作成
親カテゴリの下に子カテゴリを作成してください。

例（北海道の場合）：
- 札幌市（スラッグ: `sapporo`）
- 函館市（スラッグ: `hakodate`）
- 旭川市（スラッグ: `asahikawa`）

### タグの設定
ジャンルとして使用するタグを作成してください。

例：
- ラーメン（スラッグ: `ramen`）
- 寿司（スラッグ: `sushi`）
- カフェ（スラッグ: `cafe`）

### カテゴリサムネイルの設定（オプション）
子カテゴリにサムネイル画像を設定するには、カスタムフィールドを使用します：

```php
// functions.php に追加（またはAdvanced Custom Fieldsを使用）
update_term_meta($category_id, 'thumbnail_id', $attachment_id);
```

## URLリライトルール

このプラグインは以下のURL構造に対応しています：

```
https://umaten.jp/hokkaido/子カテゴリ/ジャンル/
```

例：
```
https://umaten.jp/hokkaido/sapporo/ramen/
https://umaten.jp/hokkaido/hakodate/sushi/
```

## 月間アクセス数の取得について

プラグインは以下のアクセスログプラグインに対応しています：

### 推奨プラグイン

#### 1. WP Statistics（推奨）
- 最も正確な統計を取得可能
- ボットとユーザーを区別して集計
- インストール: WordPress管理画面 → プラグイン → 新規追加 → 「WP Statistics」で検索

#### 2. Jetpack（サイト統計）
- WordPress.com公式プラグイン
- シンプルで軽量
- インストール: WordPress管理画面 → プラグイン → 新規追加 → 「Jetpack」で検索

#### 3. 独自のビューカウント
- カスタムフィールド `post_views_count` を使用
- 各投稿のビュー数の合計を表示

### アクセスログプラグインがない場合

プラグインがインストールされていない場合、概算値（投稿数 × 100）が表示されます。

正確な統計を表示するには、上記のいずれかのプラグインをインストールすることを強く推奨します。

## トラブルシューティング

### 子カテゴリが表示されない
1. 親カテゴリのスラッグが正しく設定されているか確認
2. 子カテゴリが実際に存在するか確認
3. 子カテゴリの親が正しく設定されているか確認

### タグが表示されない
1. タグが実際に作成されているか確認
2. JavaScriptコンソールでエラーがないか確認

### モーダルが表示されない
1. jQueryが正しく読み込まれているか確認
2. 他のプラグインとの競合がないか確認
3. ブラウザのコンソールでJavaScriptエラーを確認

### スタイルが崩れる
1. テーマのCSSとの競合を確認
2. ブラウザのキャッシュをクリア
3. プラグインを再有効化

## 技術仕様

### 必須環境
- WordPress 5.0 以上
- PHP 7.0 以上
- jQuery（WordPressに同梱）

### 使用技術
- PHP (OOP)
- JavaScript (jQuery)
- CSS3
- AJAX
- WordPress REST API

### ファイル構成
```
umaten-toppage/
├── umaten-toppage.php          # メインファイル
├── includes/
│   ├── class-admin-settings.php # 管理画面
│   ├── class-ajax-handler.php   # AJAX処理
│   └── class-shortcode.php      # ショートコード
├── assets/
│   ├── css/
│   │   └── toppage.css          # スタイルシート
│   └── js/
│       └── toppage.js           # JavaScript
└── README.md                    # このファイル
```

## ライセンス

GPL v2 or later

## 作者

Umaten
https://umaten.jp

## バージョン履歴

### 1.1.0 (2025-11-13)
- **新機能**: 「すべてのジャンル」ボタンを追加
- **改善**: 統計バーの計算ロジック改善
  - 口コミ数を投稿数×3に変更
  - 月間アクセス数表示（アクセスログプラグイン連携）
- **修正**: 子カテゴリ表示を画像なしのシンプルデザインに変更
- **修正**: モーダルのクリックイベント問題を解決
- **修正**: イベント委譲の改善

### 1.0.0 (2025-11-13)
- 初回リリース
- 動的エリア管理機能
- 3段階ナビゲーション実装
- レスポンシブデザイン対応
- AJAX対応
- 管理画面実装

## サポート

問題が発生した場合は、以下の情報を添えてお問い合わせください：
- WordPressのバージョン
- PHPのバージョン
- 使用しているテーマ
- 有効化しているプラグインのリスト
- エラーメッセージ（あれば）

## 今後の予定

- [ ] カテゴリサムネイル管理画面の実装
- [ ] エリアの並び順カスタマイズ機能
- [ ] カラースキームのカスタマイズ機能
- [ ] 多言語対応
- [ ] パフォーマンス最適化
